<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ¬è™« - MoAgent</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ğŸ•·ï¸ æ™ºèƒ½çˆ¬è™«</h1>
            <p class="subtitle">æ”¯æŒå¤šç§çˆ¬å–æ¨¡å¼çš„æ™ºèƒ½çˆ¬è™«ç³»ç»Ÿ</p>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <a href="{{ url_for('index') }}" class="nav-link">é¦–é¡µ</a>
            <a href="{{ url_for('crawl_page') }}" class="nav-link active">çˆ¬è™«</a>
            <a href="{{ url_for('rag_page') }}" class="nav-link">RAGç³»ç»Ÿ</a>
            <a href="{{ url_for('multi_agent_page') }}" class="nav-link">Multi-Agent</a>
            <a href="{{ url_for('dashboard') }}" class="nav-link">ç›‘æ§</a>
            <a href="{{ url_for('storage_page') }}" class="nav-link">å­˜å‚¨</a>
            <a href="{{ url_for('config_page') }}" class="nav-link">é…ç½®</a>
        </nav>

        <!-- Crawling Form -->
        <section class="form-section">
            <h2>å¼€å§‹çˆ¬å–</h2>
            <form id="crawl-form" class="crawl-form">
                <div class="form-group">
                    <label for="url">ç›®æ ‡URL *</label>
                    <input type="url" id="url" name="url" placeholder="https://example.com" required class="form-input">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="mode">çˆ¬å–æ¨¡å¼</label>
                        <select id="mode" name="mode" class="form-select">
                            <option value="auto">è‡ªåŠ¨ (æ¨è)</option>
                            <option value="static">é™æ€é¡µé¢</option>
                            <option value="dynamic">åŠ¨æ€é¡µé¢</option>
                            <option value="rss">RSSè®¢é˜…</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="depth">çˆ¬å–æ·±åº¦</label>
                        <input type="number" id="depth" name="depth" min="1" max="5" value="1" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="use-rag" name="use_rag">
                        <span>ä½¿ç”¨RAGå¢å¼ºæ¨¡å¼ (æ¨è)</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary" id="submit-btn">
                    å¼€å§‹çˆ¬å–
                </button>
            </form>
        </section>

        <!-- Results Section -->
        <section id="results-section" class="results-section" style="display: none;">
            <h2>çˆ¬å–ç»“æœ</h2>

            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>æ­£åœ¨çˆ¬å–ï¼Œè¯·ç¨å€™...</p>
            </div>

            <div id="results-content" style="display: none;">
                <div class="results-summary">
                    <div class="summary-card">
                        <h3>çˆ¬å–ç»Ÿè®¡</h3>
                        <ul>
                            <li>çˆ¬å–æ•°é‡: <strong id="crawled-count">-</strong></li>
                            <li>è§£ææ•°é‡: <strong id="parsed-count">-</strong></li>
                            <li>å­˜å‚¨æ•°é‡: <strong id="stored-count">-</strong></li>
                        </ul>
                    </div>
                </div>

                <div class="results-list">
                    <h3>çˆ¬å–å†…å®¹ (å‰10æ¡)</h3>
                    <div id="items-list"></div>
                </div>
            </div>

            <div id="error-content" class="error-content" style="display: none;">
                <h3>âŒ é”™è¯¯</h3>
                <pre id="error-message"></pre>
            </div>
        </section>

        <!-- AI Pattern Generator -->
        <section class="form-section" id="pattern-generator">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>ğŸ¤– æ™ºèƒ½æ¨¡å¼ç”Ÿæˆå™¨</h2>
                <button id="toggle-generator" class="btn btn-secondary">å±•å¼€/æ”¶èµ·</button>
            </div>

            <div id="generator-content" style="display: none;">
                <!-- Step 1: Input HTML -->
                <div class="generator-step">
                    <h3>æ­¥éª¤ 1: æä¾›ç½‘é¡µHTML</h3>

                    <div class="form-group">
                        <label>æ–¹æ³•A: ç²˜è´´HTMLæºä»£ç </label>
                        <textarea id="html-input" rows="8" class="form-input" placeholder="åœ¨æ­¤ç²˜è´´ç½‘é¡µHTMLæºä»£ç ..."></textarea>
                    </div>

                    <div style="text-align: center; margin: 20px 0;">â€” æˆ– â€”</div>

                    <div class="form-group">
                        <label>æ–¹æ³•B: æä¾›URL (è‡ªåŠ¨è·å–HTML)</label>
                        <div class="form-row">
                            <input type="url" id="pattern-url" class="form-input" placeholder="https://example.com">
                            <button id="fetch-html-btn" class="btn btn-secondary">
                                ğŸ“¥ è·å–HTML
                            </button>
                        </div>
                        <small class="text-secondary">æ³¨æ„: æŸäº›ç½‘ç«™å¯èƒ½æ— æ³•ç›´æ¥è·å–HTML</small>
                    </div>

                    <button id="generate-pattern-btn" class="btn btn-primary" style="margin-top: 15px;">
                        ğŸ¤– ç”Ÿæˆçˆ¬å–æ¨¡å¼
                    </button>

                    <!-- Error Display -->
                    <div id="generate-error" class="error-message-box" style="display: none; margin-top: 15px;">
                        <h4 style="color: #d32f2f;">âŒ é”™è¯¯</h4>
                        <pre id="generate-error-text" style="background: #ffebee; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
                    </div>
                </div>

                <!-- Step 2: Generated Pattern -->
                <div id="generated-pattern-section" class="generator-step" style="display: none;">
                    <h3>æ­¥éª¤ 2: ç”Ÿæˆçš„æ¨¡å¼</h3>

                    <div id="pattern-display" class="pattern-display">
                        <!-- Pattern will be displayed here -->
                    </div>

                    <div class="button-group" style="margin-top: 15px;">
                        <button id="test-pattern-btn" class="btn btn-secondary">
                            ğŸ§ª æµ‹è¯•æ¨¡å¼
                        </button>
                        <button id="refine-btn" class="btn btn-warning">
                            âš¡ ä¼˜åŒ–æ¨¡å¼
                        </button>
                        <button id="apply-pattern-btn" class="btn btn-success">
                            âœ… åº”ç”¨å¹¶çˆ¬å–
                        </button>
                    </div>
                </div>

                <!-- Step 3: Test Results -->
                <div id="test-results-section" class="generator-step" style="display: none;">
                    <h3>æ­¥éª¤ 3: æµ‹è¯•ç»“æœ</h3>

                    <div id="test-stats" class="test-stats">
                        <!-- Test statistics will be displayed here -->
                    </div>

                    <div id="extracted-items" class="extracted-items">
                        <h4>æå–çš„é¡¹ç›®é¢„è§ˆ (å‰5æ¡)</h4>
                        <div id="items-preview"></div>
                    </div>

                    <!-- Error Display -->
                    <div id="test-error" class="error-message-box" style="display: none; margin-top: 15px;">
                        <h4 style="color: #d32f2f;">âŒ æµ‹è¯•é”™è¯¯</h4>
                        <pre id="test-error-text" style="background: #ffebee; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
                    </div>
                </div>

                <!-- Step 4: Refinement -->
                <div id="refine-section" class="generator-step" style="display: none;">
                    <h3>æ­¥éª¤ 4: ä¼˜åŒ–æ¨¡å¼</h3>

                    <div class="form-group">
                        <label for="feedback-input">æä¾›åé¦ˆä»¥ä¼˜åŒ–æ¨¡å¼:</label>
                        <textarea id="feedback-input" rows="3" class="form-input"
                            placeholder="ä¾‹å¦‚: åŒ…å«äº†å¯¼èˆªé“¾æ¥ï¼Œéœ€è¦æ’é™¤ / æ¼æ‰äº†ä¸€äº›æ–‡ç«  / æ ‡é¢˜ä¸å‡†ç¡®..."></textarea>
                    </div>

                    <div class="feedback-suggestions">
                        <p><strong>å¸¸ç”¨åé¦ˆç¤ºä¾‹:</strong></p>
                        <button class="feedback-btn btn-sm" data-feedback="åŒ…å«äº†å¯¼èˆªé“¾æ¥å’Œèœå•é¡¹ï¼Œéœ€è¦æ’é™¤">æ’é™¤å¯¼èˆª</button>
                        <button class="feedback-btn btn-sm" data-feedback="æ¼æ‰äº†ä¸€äº›æ–‡ç« ï¼Œè¯·æ‰©å¤§æœç´¢èŒƒå›´">æ‰©å¤§èŒƒå›´</button>
                        <button class="feedback-btn btn-sm" data-feedback="æŠ“å–äº†å¾ˆå¤šä¸ç›¸å…³çš„å†…å®¹ï¼Œéœ€è¦æ›´ç²¾ç¡®çš„é€‰æ‹©å™¨">æé«˜ç²¾åº¦</button>
                        <button class="feedback-btn btn-sm" data-feedback="æ—¥æœŸæå–ä¸å‡†ç¡®ï¼Œéœ€è¦ä¿®å¤æ—¥æœŸé€‰æ‹©å™¨">ä¿®å¤æ—¥æœŸ</button>
                    </div>

                    <button id="submit-refine-btn" class="btn btn-primary" style="margin-top: 15px;">
                        âš¡ æäº¤ä¼˜åŒ–
                    </button>

                    <!-- Error Display -->
                    <div id="refine-error" class="error-message-box" style="display: none; margin-top: 15px;">
                        <h4 style="color: #d32f2f;">âŒ ä¼˜åŒ–é”™è¯¯</h4>
                        <pre id="refine-error-text" style="background: #ffebee; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
                    </div>

                    <div id="refine-results" style="display: none; margin-top: 15px;">
                        <!-- Refinement results will be displayed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Storage Stats -->
        <section class="stats-section">
            <h2>å­˜å‚¨ç»Ÿè®¡</h2>
            <button id="refresh-stats" class="btn btn-secondary">åˆ·æ–°ç»Ÿè®¡</button>
            <div id="storage-stats" class="stats-grid">
                <div class="stat-card">
                    <h4>æ€»é¡¹ç›®æ•°</h4>
                    <p id="stat-total" class="stat-number">-</p>
                </div>
                <div class="stat-card">
                    <h4>æœ€æ–°é¡¹ç›®</h4>
                    <p id="stat-latest" class="stat-number">-</p>
                </div>
            </div>
        </section>

    </div>



    <style>
        /* Pattern Generator Styles */
        .generator-step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .pattern-display {
            background: white;
            padding: 20px;
            border-radius: 4px;
            border-left: 4px solid var(--primary-color);
        }

        .pattern-field {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .pattern-field label {
            font-weight: 600;
            color: var(--primary-color);
            display: block;
            margin-bottom: 5px;
        }

        .pattern-field code {
            background: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
        }

        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .test-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .test-stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .extracted-items {
            margin-top: 20px;
        }

        .item-preview {
            background: white;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            border-left: 3px solid var(--success-color);
        }

        .item-preview-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-preview-url {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .feedback-suggestions {
            margin-top: 10px;
        }

        .feedback-btn {
            margin: 5px;
            padding: 5px 10px;
            font-size: 0.85rem;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            transition: width 0.3s;
        }

        .improvement-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .improvement-high {
            background: #d4edda;
            color: #155724;
        }

        .improvement-medium {
            background: #fff3cd;
            color: #856404;
        }

        .improvement-low {
            background: #f8d7da;
            color: #721c24;
        }
    </style>

    <script src="{{ url_for('static', filename='js/crawl.js') }}"></script>
</body>

</html>